{# viewer/templates/view_summaries.html #}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>All Individual Summaries</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header>
        <h1>All Individual Keyword Summaries</h1>
    </header>
    <nav>
        <ul>
            <li><a href="{{ url_for('index') }}">Home</a></li>
        </ul>
    </nav>
    <section>
        {% if summaries %}
        {# mutable namespace to track the last date seen #}
        {% set ns = namespace(last_date=None, started=False) %}

        {% for summary in summaries %}
        {% if summary[1] != 'analysis' %}
        {% set current_date = summary[4][:10] %}

        {# whenever the date changes, close the previous list (if any), print header & open a new list #}
        {% if current_date != ns.last_date %}
        {% if ns.started %}
        </ul>
        {% endif %}
        <h3 class="date-header">{{ current_date }}</h3>
        <ul>
            {% set ns.started = True %}
            {% set ns.last_date = current_date %}
            {% endif %}

            <li>
                <span>
                    <strong>{{ summary[1] | capitalize }} – {{ summary[2] }}</strong>
                    <small>(Time: {{ summary[4][11:] }})</small>
                </span>
                <div class="actions">
                    <a href="{{ url_for('view_summary', summary_id=summary[0]) }}" class="view-link">View</a>
                    <a href="{{ url_for('download_summary', summary_id=summary[0]) }}" class="download-link">Download
                        MD</a>
                </div>
            </li>
            {% endif %}
            {% endfor %}

            {# close the very last list #}
            {% if ns.started %}
        </ul>
        {% endif %}
        {% else %}
        <p>No individual summaries available.</p>
        {% endif %}
    </section>
    <footer>
        <p>© {{ now.year }} Market Research Project</p>
    </footer>
    {# Ensure 'now' context processor is active for the footer #}
</body>

</html>