{# viewer/templates/view_summaries.html #}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>All Individual Summaries</title>
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> -->
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        header,
        footer {
            background-color: #333;
            color: #fff;
            padding: 10px 20px;
            text-align: center;
        }

        nav {
            background-color: #444;
            padding: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        nav li {
            display: inline;
            margin: 0 15px;
        }

        nav a {
            color: #333;
            text-decoration: none;
            font-weight: bold;
        }

        section {
            background: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2 {
            color: #333;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        /* Style for the date headers */
        .date-header {
            margin-top: 25px;
            /* Add space above the header */
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #ccc;
            /* Separator line */
            color: #555;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* Style for the list items */
        li {
            background: #eee;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid #5cb85c;
            /* Add a small color indicator */
        }

        li span {
            flex-grow: 1;
            margin-right: 15px;
        }

        li small {
            color: #666;
            font-size: 0.9em;
        }

        .actions a {
            margin-left: 10px;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .view-link {
            background-color: #5cb85c;
            color: white;
        }

        .download-link {
            background-color: #337ab7;
            color: white;
        }

        p {
            color: #555;
        }
    </style>
</head>

<body>
    <header>
        <h1>All Individual Keyword Summaries</h1>
    </header>
    <nav>
        <ul>
            <li><a href="{{ url_for('index') }}">Home</a></li>
        </ul>
    </nav>
    <section>
        {% if summaries %}
        {# mutable namespace to track the last date seen #}
        {% set ns = namespace(last_date=None, started=False) %}

        {% for summary in summaries %}
        {% if summary[1] != 'analysis' %}
        {% set current_date = summary[4][:10] %}

        {# whenever the date changes, close the previous list (if any), print header & open a new list #}
        {% if current_date != ns.last_date %}
        {% if ns.started %}
        </ul>
        {% endif %}
        <h3 class="date-header">{{ current_date }}</h3>
        <ul>
            {% set ns.started = True %}
            {% set ns.last_date = current_date %}
            {% endif %}

            <li>
                <span>
                    <strong>{{ summary[1] | capitalize }} – {{ summary[2] }}</strong>
                    <small>(Time: {{ summary[4][11:] }})</small>
                </span>
                <div class="actions">
                    <a href="{{ url_for('view_summary', summary_id=summary[0]) }}" class="view-link">View</a>
                    <a href="{{ url_for('download_summary', summary_id=summary[0]) }}" class="download-link">Download
                        MD</a>
                </div>
            </li>
            {% endif %}
            {% endfor %}

            {# close the very last list #}
            {% if ns.started %}
        </ul>
        {% endif %}
        {% else %}
        <p>No individual summaries available.</p>
        {% endif %}
    </section>
    <footer>
        <p>© {{ now.year }} Market Research Project</p>
    </footer>
    {# Ensure 'now' context processor is active for the footer #}
</body>

</html>